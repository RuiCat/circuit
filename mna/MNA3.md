# 改进节点分析的算法

本文档描述了一种算法方法，用于生成只有电阻和独立源的系统的改进节点分析（MNA）方程。它由几个部分组成：

## 目录
- 回顾
- 符号约定
- 生成MNA矩阵
- 总结

本文页面的许多思想和符号来自Litovski，但这里的讨论相当简单，因为只考虑独立电压源和电流源。

## 回顾

回顾上一个文档：

应用于只有无源元件（电阻）和独立电流源和电压源的电路的MNA产生形式为的矩阵方程：
```
Ax = z
```

对于具有n个节点和m个独立电压源的电路：

- **A矩阵**：
  - 大小为(m+n)×(m+n)，并且只由已知量组成。
  - 矩阵左上角的n×n部分：
    - 只有无源元件
    - 连接到地的元件只出现在对角线上
    - 未连接到地的元件同时出现在对角线上和非对角线项上。
  - A矩阵的其余部分（不包括在n×n左上部分中）只包含1、-1和0（如果有受控电流源和电压源，可能有其他值；我没有考虑这些情况。如果有兴趣，请咨询Litovski。）
- **x矩阵**：
  - 是一个(n+m)×1向量，保存未知量（节点电压和通过独立电压源的电流）。
  - 最上面的n个元素是n个节点电压。
  - 最下面的m个元素代表电路中m个独立电压源的电流。
- **z矩阵**：
  - 是一个(n+m)×1向量，只保存已知量
  - 最上面的n个元素要么是零，要么是电路中独立电流源的总和和差。
  - 最下面的m个元素代表电路中m个独立电压源。

电路通过简单的矩阵操作求解：
```
x = A⁻¹z
```

虽然这可能很难手工完成，但它是直接的，因此很容易由计算机完成。

## 符号约定

显然，使用的符号不会改变解。然而下面描述的约定将使开发电路求解所需的矩阵变得非常容易。

- 地标记为节点0。
- 其他节点从1到n连续标记。
- 我们将节点1的电压称为v_1，节点2的电压称为v_2，依此类推。
- 独立电压源的命名相当宽松，但名称必须以字母"V"开头，并且必须与任何节点名称不同。对于我们的目的，我们将要求独立电压源在其名称中没有下划线("_")。因此名称Va、Vsource、V1、Vxyz123都是合法的名称，但V_3、V_A、Vsource_1不是。
- 通过电压源的电流将标记为"I_"后跟电压源的名称。因此通过Va的电流是I_Va，通过VSource的电流是I_VSource，等等...
- 独立电流源的命名类似；名称必须以字母"I"开头，并且在其名称中没有下划线("_")。因此名称Ia、Isource、I1、Ixyz123都是合法的名称，但I_3、I_A、Isource_1不是。
- 注意：其中一些规则是任意的（特别是命名约定），但将使基于MATLAB的算法开发更容易。

这些规则有些限制性（比它们需要的更严格），但它们使算法的开发更容易，同时仍然允许相当大的自由度。

这些规则很容易用一个示例解释（来自上一页的示例3）：

这个电路根据上述指南标记。地是节点0，其他两个节点标记为1和2。电压源和电流源有标签，没有下划线，通过电压源Vs1的电流标记为I_Vs1。我们将在下面讨论如何使用这个图（带有这些标签）来生成MNA方程。

## 生成MNA矩阵

我们需要生成三个矩阵：A矩阵、x矩阵和z矩阵。每个都将通过组合几个单独的子矩阵来创建。为了激发生成矩阵的规则，我们将考虑下面的两个示例电路（来自上一个网页的示例2和示例3，使用上述符号约定）。我只是陈述得到的MNA方程，但在下面的文本中，我们将展示如何生成每一个。

### 案例1
电路图

### 案例2
电路图

## A矩阵

A矩阵将作为4个较小矩阵G、B、C和D的组合来开发：
```
A = [G B; C D]
```

A矩阵是(m+n)×(m+n)（n是节点数，m是独立电压源数），并且：

- G矩阵是n×n，由无源电路元件（电阻）之间的互连决定
- B矩阵是n×m，由电压源的连接决定
- C矩阵是m×n，由电压源的连接决定（B和C密切相关，特别是当只考虑独立源时）
- D矩阵是m×m，如果只考虑独立源则为零

### 制作G矩阵的规则

G矩阵是一个n×n矩阵，分两步形成：

1. 对角矩阵中的每个元素等于连接到相应节点的每个元件的电导（电阻的倒数）之和。因此第一个对角元素是连接到节点1的电导之和，第二个对角元素是连接到节点2的电导之和，依此类推。
2. 非对角元素是连接到相应节点对的元件的负电导。因此节点1和2之间的电阻进入G矩阵的位置(1,2)和位置(2,1)。

### 演示

如果一个元件接地，它将只对G矩阵中的一个条目有贡献——在对角线上的适当位置。如果它未接地，它将贡献矩阵中的四个条目——两个对角条目（对应于两个节点）和两个非对角条目。

### 制作B矩阵的规则

B矩阵是一个n×m矩阵，只有0、1和-1元素。矩阵中的每个位置对应于一个特定的电压源（第一维）或一个节点（第二维）。如果第i个电压源的正端子连接到节点k，则B矩阵中的元素(i,k)是1。如果第i个电压源的负端子连接到节点k，则B矩阵中的元素(i,k)是-1。否则，B矩阵的元素为零。

### 演示
案例2
电路图 | MNA方程
---|---
B = [1; -1]

如果电压源未接地，它将在B矩阵中有两个元素（同一列中的1和-1）。如果它接地，它将只在矩阵中有一个元素。

### 制作C矩阵的规则

C矩阵是一个m×n矩阵，只有0、1和-1元素。矩阵中的每个位置对应于一个特定的节点（第一维）或电压源（第二维）。如果第i个电压源的正端子连接到节点k，则C矩阵中的元素(k,i)是1。如果第i个电压源的负端子连接到节点k，则C矩阵中的元素(k,i)是-1。否则，C矩阵的元素为零。

换句话说，C矩阵是B矩阵的转置。（当存在受控源时，情况并非如此。）

案例1：C = [-1 1 0; 0 0 1]

案例2：C = [1; -1]

### 制作D矩阵的规则

D矩阵是一个m×m矩阵，完全由零组成。（如果考虑受控源，它可以非零。）

案例1：D = [0 0; 0 0]

案例2：D = [0]

## x矩阵

x矩阵保存我们的未知量，并将作为2个较小矩阵v和j的组合来开发。它比A矩阵容易定义得多。
```
x = [v; j]
```

x矩阵是(m+n)×1（n是节点数，m是独立电压源数），并且：

- v矩阵是n×1，保存未知电压
- j矩阵是m×1，保存通过电压源的未知电流

### 制作v矩阵的规则

v矩阵是一个n×1矩阵，由节点电压组成。v中的每个元素对应于电路中等效节点的电压（没有地——节点0的条目）。

例如，如果一个电路有三个节点，v矩阵是：
```
v = [v_1; v_2; v_3]
```

对于有n个节点的电路，我们得到：
```
v = [v_1; ...; v_n]
```

依此类推。

### 制作j矩阵的规则

j矩阵是一个m×1矩阵，每个电压源的电流有一个条目。因此如果有两个电压源V1和V2，j矩阵将是：
```
j = [i_V1; i_V2]
```

x矩阵的演示。
案例1
电路图 | MNA方程
---|---
v = [v_1; v_2; v_3], j = [i_V1; i_V2], x = [v; j] = [v_1; v_2; v_3; i_V1; i_V2]

案例2
电路图 | MNA方程
---|---
v = [v_1; v_2], j = [i_Vs1], x = [v; j] = [v_1; v_2; i_Vs1]

## z矩阵

z矩阵保存我们的独立电压源和电流源，并将作为2个较小矩阵i和e的组合来开发。它很容易制定。
```
z = [i; e]
```

z矩阵是(m+n)×1（n是节点数，m是独立电压源数），并且：

- i矩阵是n×1，包含通过无源元件进入相应节点的电流之和（要么是零，要么是独立电流源之和）。
- e矩阵是m×1，保存独立电压源的值。

### 制作i矩阵的规则

i矩阵是一个n×1矩阵，矩阵的每个元素对应于一个特定的节点。i的每个元素的值由进入相应节点的电流源之和决定。如果没有电流源连接到节点，则该值为零。

### 制作e矩阵的规则

e矩阵是一个m×1矩阵，矩阵的每个元素等于相应的独立电压源的值。

z矩阵的演示。
案例1
电路图 | MNA方程
---|---
i = [0; 0; 0], e = [V1; V2], z = [0; 0; 0; V1; V2]

案例2
电路图 | MNA方程
---|---
i = [Is1; 0], e = [Vs1], z = [Is1; 0; Vs1]

## 组合在一起

我们现在可以为两个一直在开发的案例写出完整的矩阵解。
案例1
电路图 | MNA方程
---|---
[1/R1, 0, 0, -1, 0;
 0, 1/R2 + 1/R3, -1/R2, 1, 0;
 0, -1/R2, 1/R2, 0, 1;
 -1, 1, 0, 0, 0;
 0, 0, 1, 0, 0] * [v_1; v_2; v_3; i_V1; i_V2] = [0; 0; 0; V1; V2]

案例2
电路图 | MNA方程
---|---
[1/R1 + 1/R2, -1/R2, 1;
 -1/R2, 1/R2 + 1/R3, -1;
 1, -1, 0] * [v_1; v_2; i_Vs1] = [Is1; 0; Vs1]

如果您仍然不确定算法的应用，还有一些更多的示例可用。

到目前为止，我们只处理了电阻和独立电压源和电流源。下一个文档将显示添加电容器和电感器是微不足道的，添加运放只会稍微增加难度。

## 参考文献

- Litovski, V. (2007). Lecture Notes on Electronic Circuits. University of Niš.
- DeCarlo, R. A., & Lin, P. M. (1995). Linear Circuit Analysis: Time Domain, Phasor, and Laplace Transform Approaches. Oxford University Press.
